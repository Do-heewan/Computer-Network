# 네트워크 계층 : Data Plane

<br>

## 네트워크 계층 개요

### 주요기능

- 전송 : 송신 호스트에서 수신 호스트로 세그먼트 전달
- 캡슐화 : 송신자는 세그먼트를 데이터그램으로 캡슐화하여 링크 계층으로 전달
- 전달 : 수신자는 세그먼트를 전송 계층 프로토콜로 전달
- 라우터 : 모든 IP 데이터그램의 헤더 필드를 검사하고 입력 포트에서 출력 포트로 이동

### 네트워크 계층의 두 가지 핵심 기능
1. 포워딩 (Forwarding) : 라우터의 입력 링크에서 적절한 출력 링크로 패킷 이동
2. 라우팅 (Routing) : 소스에서 목적지까지의 경로 결정

<br>

## 데이터 평면 VS 제어 평면

### 데이터 평면
- 로컬, 라우터별 기능
- 라우터 입력 포트에 도착한 데이터그램이 어떻게 출력 포트로 전달되는지 결정

### 제어 평면
- 네트워크 전체 로직
- 소스 호스트에서 목적지 호스트까지 라우터들 간의 데이터그램 라우팅 방법 결정

### 제어 평면의 두 가지 접근법
1. 전통적 라우팅 알고리즘 : 각 라우터에서 구현
2. 소프트웨어 정의 네트워킹(SDN) : 원격 서버에서 구현

<br>

## 목적지 기반 포워딩

### Longest prefix matching
- 주어진 목적지 주소에 대한 포워딩 테이블 엔트리를 찾을 때
- 목적지 주소와 일치하는 가장 긴 주소 접두사 사용

<br>

## IP 프로토콜

### IP Datagram 형식
- Ipv4 : 32비트 주소, 20 바이트 기본 헤더

### IP 주소 지정
- IP 주소 : 각 호스트나 라우터 인터페이스와 연관된 32비트 식별자
- 인터페이스 : 호스트/라우터와 물리적 링크 간의 연결
- 점 십진법 표기법

### Subnet
- 정의 : 중간 라우터를 거치지 않고 물리적으로 서로 도달할 수 있는 장치 인터페이스들
- 구조 : 서브넷 부분(공통 상위 비트) + 호스트 부분(나머지 하위 비트)
- 서브넷 마스크 : 상위 24비트

### CIDR(Classless InterDomain Routing)
- 형식 : a.b.c.d/x (x는 서브넷 부분의 비트수)
- 임의 길이의 서브넷 부분 주소 지원

### IPv6
- 동기 : 32비트 IPv4 주소 공간의 완전 할당 우려
- 특징
    - 128비트 주소
    - 40바이트 고정 길이 헤더
    - checksum 없음
    - 단편화 / 재조립 없음
    - 옵션 없음

<br>

## 일반화된 포워딩과 SDN

### Match + Action 추상화
- 매치 : 도착 패킷의 헤더 필드 값과 패턴 매칭
- 액션 : 매치된 패킷에 대해 드롭, 포워드, 수정, 로그 등의 작업 수행

### 플로우 테이블
- 플로우 : 헤더 필드 값으로 정의
- 구성 요소
    - 매치 : 패킷 헤더 필드의 패턴값
    - 액션 : 매치된 패킷에 대한 작업
    - 우선순위 : 중복 패턴 구분
    - 카운터 : 바이트 및 패킷 수

### Open Flow
- 다양한 장치 통합 : 라우터, 스위치, 방화벽, NAT를 동일한 match + action 추상화로 통합
- 매치 필드 : 링크, 네트워크, 전송 계층의 다양한 헤더 필드 지원
- 액션 : 포트 전달, 패킷 드롭, 헤더 필드 수정, 컨트롤러로 캡슐화 및 전딜